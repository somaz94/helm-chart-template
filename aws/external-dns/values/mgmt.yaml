# External-DNS Route53 Configuration
image:
  repository: registry.k8s.io/external-dns/external-dns
  pullPolicy: IfNotPresent

serviceAccount:
  create: true
  annotations:
    # EKS IAM Role for Service Account (IRSA) - 실제 Role ARN으로 변경 필요
    eks.amazonaws.com/role-arn: arn:aws:iam::010xxxxxxxxx:role/external-dns-role

# 시스템 노드그룹에 배포
nodeSelector:
  eks.amazonaws.com/nodegroup: Somaz-NodeGroup-worker-node

# Pod 보안 설정
podSecurityContext:
  runAsNonRoot: true
  fsGroup: 65534

securityContext:
  privileged: false
  allowPrivilegeEscalation: false
  readOnlyRootFilesystem: true
  runAsNonRoot: true
  runAsUser: 65532
  runAsGroup: 65532
  capabilities:
    drop: ["ALL"]

rbac:
  create: true

# 리소스 제한
resources:
  requests:
    cpu: 50m
    memory: 64Mi
  limits:
    cpu: 200m
    memory: 256Mi

# 로그 설정
logLevel: info
logFormat: text

# # luckyday 네임스페이스만 모니터링
# namespaced: true

# DNS 업데이트 간격
interval: 5m

# 모니터링할 리소스 유형
sources:
  - service
  - ingress

# DNS 레코드 관리 정책
policy: upsert-only # 정책 설명 추가 : 레코드가 없으면 생성하고, 있으면 업데이트

# TXT 레코드 레지스트리 설정
registry: txt
txtOwnerId: "somaz-external-dns"
txtPrefix: "external-dns-"

# 도메인 필터 - luckyday.soulssvc.com만 관리
domainFilters:
  - somaz.link

# AWS Route53 프로바이더
provider:
  name: aws

# External-DNS 추가 설정
extraArgs:
  - --aws-zone-type=public
  - --aws-prefer-cname